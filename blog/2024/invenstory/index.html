<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Invenstory - decentralized inventory tracking with WiFi fingerprinting | Hassan Ali Amjad </title> <meta name="author" content="Hassan Ali Amjad"> <meta name="description" content="Hassan's personal website "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%88%B7&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hsnali.me/blog/2024/invenstory/"> <script src="/assets/js/theme.js?938610c9d39efcde4fbf0014898ca123"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Hassan Ali</span> Amjad </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">me </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/school/">school </a> </li> <li class="nav-item "> <a class="nav-link" href="/work/">work </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Invenstory - decentralized inventory tracking with WiFi fingerprinting</h1> <p class="post-meta"> Created in December 11, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/project"> <i class="fa-solid fa-hashtag fa-sm"></i> project</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Making a lean inventory tracking system that will monotonically imporve with time.</p> <p>A warehouse operates as a decentralized system with a shared state. Each asset moves inventory independently with a plan agreed upon between all assets. An <em>asset</em> here can be a forklift, pallet jack, etc… There is a lot of active <a href="https://uwaterloo.ca/analytics-optimization-lab/projects/adding-data-analytics-warehouse-logistics" rel="external nofollow noopener" target="_blank">research</a> going into how to optimize inventory management in these facilities. I will not bore you with collected data and research developments, but will present to you a fun solution to generate the data needed for these optimizations.</p> <p>How does one start with tracking the inventory? With tracking the assets that move the inventory.</p> <h2 id="how-do-you-track-location">How do you track location?</h2> <p>This is a geolocation problem. As inventory is commonly stored in indoor spaces, GPS is out the door. A question at the root of designing the positioning system is:</p> <blockquote> <p>Should the system track the location of each asset centrally, or should each asset independently determine and report its own location?</p> </blockquote> <p><strong>System tracks each asset</strong></p> <p>This would be a centralized system tracking the location of each asset in the facility. Example: cameras strategically placed around the warehouse tracking the location of all assets using computer vision. This approach has high overhead and is prone to vision obstruction, but it demonstrates centralized tracking clearly.</p> <p>The benefit is that you have a fixed cost which won’t scale with your number of assets. Only one “computer” is required to monitor all activities in the warehouse.</p> <p><strong>Asset reports to system</strong></p> <p>This means assets tracking their own location and reporting it to an endpoint. Example: cameras placed on each asset that decode location by reading barcodes placed around facility.</p> <p>The benefit here is the reduced complexity as each agent finds their location independently, rather than a central system tracking all states simultaneously and having to differentiate between assets. You have all the other benefits that you get with a decentralized system like fault tolerance (central server goes down), scalability (no central compute contraint except for location ingestion pipeline), etc…</p> <p>One thing that’s not easy to see yet is that it opens up doors to an exciting new-ish tracking method, <a href="https://en.wikipedia.org/wiki/Wi-Fi_positioning_system" rel="external nofollow noopener" target="_blank">WiFi fingerprinting</a>. It is because the asset can track its own location, we can use this method.</p> <hr> <p><strong>Chosen Approach: Asset reports to system</strong></p> <p>This method leverages each asset’s ability to independently determine and report its location, facilitating a scalable and fault-tolerant solution.</p> <p>Let’s take a step back here, and see what options we have to implement a decentralized tracking system?</p> <ol> <li>Cameras placed on each asset to read barcodes placed around facility</li> </ol> <p>Camera feed processing will require compute power on each asset incurring overhead, and barcode maintenance and obstruction is concerning as well. This solution is not feasible.</p> <ol> <li>RFID/Bluetooth antennas placed on each asset that scan RFID/BLE “checkpoints” scattered around facility to determine asset location.</li> </ol> <p>Minimal compute required on assets, but process of placing RFID tags around facility is not easily scalable and requires ovehead on both the facility and asset side to work.</p> <ol> <li>WiFi antennas placed on each asset to measure signal strength to existing routers in facility which will determine location of asset, using WiFi fingerprinting.</li> </ol> <p>This solution solves problems with previous solutions, as it scales with WiFi routers and is cheap to implement on forklifts with a simple <a href="https://en.wikipedia.org/wiki/ESP32" rel="external nofollow noopener" target="_blank">ESP32</a> microcontroller on them. The drawback here is lower precision, dependent on factors like humidity. Considering how WiFi fingerprinting is an emerging technology, the research here will only make this solution better to implement in the future years.</p> <h3 id="wifi-fingerprinting">WiFi fingerprinting</h3> <p>Each asset will measure received signal strength (RSS) to all access points (APs), which will be a vector mapping from AP MAC addresses to RSS values. This RSS vector will be sent into a generalized pipeline for computing asset location. The pipeline also requires RSS values from predetermined reference points for comparison, which are stored in the “fingerprint database”. Here is a flowchart of the pipeline:</p> <pre><code class="language-mermaid">flowchart LR
    id2[[computeLocation]]
    id0["`**RSS vector**_i
    (RSSi1, MAC1)
    (RSSi2, MAC2)
    ...`"]
    id1[("`**FINGERPRINT DATABASE**
    [x0, y0], (RSS01, MAC1), (RSS02, MAC2), ...
    [x1, y1], (RSS11, MAC1), (RSS13, MAC3), ...
    ...`")]
    id0 --&gt; id2
    id1 --&gt; id2
    id2 --&gt; id3["Location: [xi, yi]"]
</code></pre> <p>What’s to be noted here is that choosing the location of reference points (RPs) is tricky. Wifi signal attenuates exponentially with distance, which means RPs need to placed with non-linear spacing to get a good coverage of RSS values in the facility. There will also be walls and obstructions which will bounce signals creating multiple spots with similar RSS values. Here, the multiple APs will help in triangulating asset location. RPs should be placed further from APs, so that the reduced gradient in RSS values near an AP over distance is avoided. These observations were captured in a simulation using the <a href="https://en.wikipedia.org/wiki/Path_loss" rel="external nofollow noopener" target="_blank">path lass model</a>:</p> <figure> <img src="/assets/img/wifi_fingerprinting.png" alt="WiFi fingerprinting simulation" width="500"> </figure> <p>The <code class="language-plaintext highlighter-rouge">computeLocation</code> function in the above flowchart will apply a K-Nearest-Neighbors algorithm to compute location of the asset. Here is some pseudocode:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">computeLocation</span><span class="p">(</span>
    <span class="n">observedRss</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span> <span class="n">Tuple</span><span class="p">[</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span> <span class="p">]</span> <span class="p">],</span>
    <span class="n">fingerprintDB</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="c1"># Location, RSS vector
</span>        <span class="n">Tuple</span><span class="p">[</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span> <span class="p">],</span> <span class="n">List</span><span class="p">[</span> <span class="n">Tuple</span><span class="p">[</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span> <span class="p">]:</span>
    <span class="c1"># For each point in the database:
</span>    <span class="c1">#     a. Calculate Euclidean and Manhattan distance between observed RSS values and db entry.
</span>    <span class="c1">#     c. Store the distances along with the coordinates in a list.
</span>
    <span class="c1"># Sort list of distances by Euclidean, using Manhattan to break ties.
</span>
    <span class="c1"># Select K closest points from the sorted list.
</span>
    <span class="c1"># Take weighted average of coordinates of K closest points, using inverse of distance as weight
</span>    <span class="c1">#     If any points have 0 distance, assign infinite weight to that point
</span>
    <span class="c1"># return the weighted average of [ x, y ] as location of asset
</span></code></pre></div></div> <p>As previously discussed, WiFi fingerprinting will be less precise due to environmental factors. We could add sensors to record humidity on assets and input this into the model for computing location. But a more static way of tackling this is to have less granular tracking using zoning in the warehouse. Exact dropoff and pickup points are already known. With wider zones and recorded flow of traffic, we would have enough log data to apply meaningful optimizations.</p> <h2 id="how-do-you-track-inventory">How do you track inventory?</h2> <p>Now that we know the location of the asset, how do we know what inventory is on the asset?</p> <p>A lot of facilities already use RFID tech to store package information, detect misloads, etc… We can continue to use these by adding an RFID reader to each asset. The asset will periodically scan items on it and report these items to the centralized system.</p> <p>The challenge here is to know when an item is removed from or added to the asset. This is an issue because the RFID antenna isn’t guaranteed to scan all items on the asset in each scan. One way is to add a weight sensor to determine if an item is added or removed from the asset in addition to what is scanned by the RFID reader. To minimize overhead though, time can be used as a proxy for weight. By setting a threshold, we can guartee an item has been added or removed from the asset.</p> <h2 id="whats-next">What’s next?</h2> <ul> <li>Implement WiFi fingerprinting pipeline on a small scale</li> <li>Designing a robust centralized system to handle inventory trackign and log management</li> <li>Discuss optimizations enabled by log data</li> </ul> </div> </article> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"hassanali1228/hassan","data-repo-id":"R_kgDOKw1zcg","data-category":"Comments","data-category-id":"DIC_kwDOKw1zcs4CbMEE","data-mapping":"pathname","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,a])=>giscusScript.setAttribute(t,a)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Hassan Ali Amjad. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: December 31, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script>let mermaidTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let a=document.createElement("pre");a.classList.add("mermaid");const n=document.createTextNode(t);a.appendChild(n),d.after(a)}),mermaid.initialize({theme:mermaidTheme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))});</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-me",title:"me",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-school",title:"school",description:"reflecting on what I learn at school.",section:"Navigation",handler:()=>{window.location.href="/school/"}},{id:"nav-work",title:"work",description:"detailed work experience descriptions.",section:"Navigation",handler:()=>{window.location.href="/work/"}},{id:"post-invenstory-decentralized-inventory-tracking-with-wifi-fingerprinting",title:"Invenstory - decentralized inventory tracking with WiFi fingerprinting",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/invenstory/"}},{id:"post-tackling-the-job-market-1-toml-file-at-a-time",title:"Tackling the job market 1 TOML file at a time",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/toml-resume/"}},{id:"post-immutability-in-infrastructure-and-why",title:"Immutability in Infrastructure and Why?",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/why-immutable/"}},{id:"post-a-closer-look-into-picasso-39-s-quot-what-is-quot-and-quot-what-could-be-quot",title:"A closer look into Picasso&#39;s &quot;what is&quot; and &quot;what could be&quot;",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/picasso-quote/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%68%34%61%6D%6A%61%64@%75%77%61%74%65%72%6C%6F%6F.%63%61","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/hassanali1228","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/hassan-ali-amjad","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>